---
import DefaultLayout from '@layouts/DefaultLayout.astro'
import PageHeader from '@components/PageHeader.astro'
import { Card, Pagination } from 'accessible-astro-components'
import { getCollection } from 'astro:content'
import type { GetStaticPaths, Page } from 'astro'
import type { CollectionEntry } from 'astro:content'
import { Image } from 'astro:assets'

// Import images directly for optimization
import projectImage1 from '@assets/images/projects/dreamvision.png'
import projectImage2 from '@assets/images/projects/expensely-shot.png'
import projectImage3 from '@assets/images/projects/statewide-template.png'
import projectImage4 from '@assets/images/projects/hotdog.png'
import projectImage5 from '@assets/images/projects/crop.png'
import projectImage6 from '@assets/images/projects/course-hub.png'
import drupalImage from '@assets/images/projects/course-hub.png' // Using project 5 as placeholder until drupal image is added
import courseHubImage from '@assets/images/projects/course-hub.png' // Using project 6 as placeholder until course hub image is added
import projectImage7 from '@assets/images/projects/Eclipse_Inspection.png' // Placeholder for Eclipse Inspection

export const getStaticPaths = (async ({ paginate }) => {
  const projects = await getCollection('projects')

  const projectImages = [projectImage1, projectImage2, projectImage3, projectImage4, projectImage5, projectImage6, projectImage7, drupalImage, courseHubImage]

  const projectsWithImages = projects.map((project, index) => {
    return {
      ...project,
      featuredImage: projectImages[index] || projectImages[0],
    }
  })

  return paginate(projectsWithImages, { pageSize: 20 })
}) satisfies GetStaticPaths

interface Props {
  page: Page<CollectionEntry<'projects'> & { featuredImage: any }>
}

const { page } = Astro.props

// Define custom project order
const projectOrder = [
  'Course Hub',
  'Expensely',
  'Drupal CMS Development',
  'Drupal Theming Updates',
  'Hotdog Tracker',
  'Dreamvision',
  'Eclipse Inspection & Property Services'
]

// Sort projects according to the defined order
const sortedProjects = page.data.sort((a, b) => {
  const indexA = projectOrder.indexOf(a.data.title)
  const indexB = projectOrder.indexOf(b.data.title)
  
  // If project not in order list, push to end
  if (indexA === -1) return 1
  if (indexB === -1) return -1
  
  return indexA - indexB
})
---

<DefaultLayout
  title="Portfolio"
  description="A showcase of UX design and development projects, demonstrating skills in design, prototyping, and full-stack development."
>
  <PageHeader
    title="Portfolio"
    subtitle="A curated collection of design and development projects showcasing expertise in full-stack development, UX design, and modern web technologies."
    bgType="bordered"
  />

  <section class="my-16">
    <div class="container">
      <div class="mb-12 text-center">
        <p class="text-muted text-lg max-w-3xl mx-auto">
          From interactive prototypes to production applications, each project demonstrates a commitment to accessibility, user experience, and clean code.
        </p>
      </div>

      <!-- Project Cards Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {
          sortedProjects.map((project, index) => (
            <a href={`/portfolio/${project.id}/`} class="project-card group block no-underline">
              <div class="card-container h-full flex flex-col bg-card rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:translate-y-[-8px]">
                {/* Image */}
                <div class={`relative overflow-hidden aspect-video ${project.data.title === 'Eclipse Inspection & Property Services' ? 'bg-neutral-100' : ''}`}>
                  <Image
                    src={project.featuredImage}
                    alt={project.data.title}
                    width={600}
                    height={338}
                    class={`h-full w-full transition-transform duration-500 group-hover:scale-110 ${project.data.title === 'Eclipse Inspection & Property Services' ? 'object-contain p-4' : 'object-cover'}`}
                  />
                  <div class="absolute top-4 left-4 w-12 h-12 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold text-lg shadow-lg">
                    {String(index + 1).padStart(2, '0')}
                  </div>
                </div>
                
                {/* Content */}
                <div class="flex-1 flex flex-col p-6 space-y-4">
                  <h3 class="text-2xl font-bold group-hover:text-blue-600 transition-colors">
                    {project.data.title}
                  </h3>
                  <p class="text-muted text-base flex-1">
                    {project.data.description}
                  </p>
                  
                  {project.data.tags && (
                    <div class="flex flex-wrap gap-2">
                      {project.data.tags.slice(0, 3).map((tag) => (
                        <span class="bg-blue-100 text-blue-700 rounded-full px-3 py-1 text-xs font-medium">
                          {tag}
                        </span>
                      ))}
                    </div>
                  )}
                  
                  <div class="pt-2">
                    <span class="inline-flex items-center gap-2 text-blue-600 font-semibold transition-all group-hover:gap-3">
                      View Project
                      <svg class="h-5 w-5 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                      </svg>
                    </span>
                  </div>
                </div>
              </div>
            </a>
          ))
        }
      </div>
    </div>
  </section>
</DefaultLayout>

<style lang="scss">
  .project-card {
    text-decoration: none !important;
    
    &:hover {
      text-decoration: none !important;
    }
  }
  
  .card-container {
    border: 1px solid rgba(0, 0, 0, 0.08);
    
    &:hover {
      border-color: rgba(59, 130, 246, 0.3);
    }
  }
  
  .bg-card {
    background-color: white;
  }
  
  .no-underline {
    text-decoration: none !important;
  }
  
  /* Dark mode support */
  :global(.darkmode) {
    .bg-card {
      background-color: var(--color-neutral-900);
    }
    
    .card-container {
      border-color: rgba(255, 255, 255, 0.1);
      
      &:hover {
        border-color: rgba(59, 130, 246, 0.5);
      }
    }
  }

  /* Retro mode support for Eclipse card background */
  :global(.retro-mode) {
    .bg-neutral-100 {
      background-color: rgba(0, 255, 255, 0.05);
    }
  }
</style>
