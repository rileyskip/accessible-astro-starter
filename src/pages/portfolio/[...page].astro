---
import DefaultLayout from '@layouts/DefaultLayout.astro'
import PageHeader from '@components/PageHeader.astro'
import { Card, Pagination } from 'accessible-astro-components'
import { getCollection } from 'astro:content'
import type { GetStaticPaths, Page } from 'astro'
import type { CollectionEntry } from 'astro:content'
import { Image } from 'astro:assets'

// Import images directly for optimization
import projectImage1 from '@assets/images/projects/dreamvision.png'
import projectImage2 from '@assets/images/projects/expensely-shot.png'
import projectImage3 from '@assets/images/projects/drupal-logo.png'
import projectImage4 from '@assets/images/projects/hotdog.png'
import projectImage5 from '@assets/images/projects/code.png'
import projectImage6 from '@assets/images/projects/crop.png'
import drupalImage from '@assets/images/projects/course-hub.png' // Using project 5 as placeholder until drupal image is added
import courseHubImage from '@assets/images/projects/course-hub.png' // Using project 6 as placeholder until course hub image is added

export const getStaticPaths = (async ({ paginate }) => {
  const projects = await getCollection('projects')

  const projectImages = [projectImage1, projectImage2, projectImage3, projectImage4, projectImage5, projectImage6, drupalImage, courseHubImage]

  const projectsWithImages = projects.map((project, index) => {
    return {
      ...project,
      featuredImage: projectImages[index] || projectImages[0],
    }
  })

  return paginate(projectsWithImages, { pageSize: 20 })
}) satisfies GetStaticPaths

interface Props {
  page: Page<CollectionEntry<'projects'> & { featuredImage: any }>
}

const { page } = Astro.props

// Define custom project order
const projectOrder = [
  'Course Hub',
  'Expensely',
  'Drupal CMS Development',
  'Drupal Theming Updates',
  'Hotdog Tracker',
  'Dreamvision'
]

// Sort projects according to the defined order
const sortedProjects = page.data.sort((a, b) => {
  const indexA = projectOrder.indexOf(a.data.title)
  const indexB = projectOrder.indexOf(b.data.title)
  
  // If project not in order list, push to end
  if (indexA === -1) return 1
  if (indexB === -1) return -1
  
  return indexA - indexB
})
---

<DefaultLayout
  title="Portfolio"
  description="A showcase of UX design and development projects, demonstrating skills in design, prototyping, and full-stack development."
>
  <PageHeader
    title="Portfolio"
    subtitle="A curated collection of design and development projects showcasing expertise in full-stack development, UX design, and modern web technologies."
    bgType="bordered"
  />

  <section class="my-16">
    <div class="container">
      <div class="mb-12 text-center">
        <p class="text-muted text-lg max-w-3xl mx-auto">
          From interactive prototypes to production applications, each project demonstrates a commitment to accessibility, user experience, and clean code.
        </p>
      </div>

      <!-- Project Grid -->
      <ul class="space-y-20">
        {
          sortedProjects.map((project, index) => (
            <li class="group">
              <a href={`/portfolio/${project.id}/`} class="block no-underline">
                <div class={`grid grid-cols-1 gap-8 lg:grid-cols-5 items-center ${index % 2 === 1 ? 'lg:grid-flow-dense' : ''}`}>
                  <div class={`space-y-4 flex flex-col justify-center lg:col-span-3 ${index % 2 === 1 ? 'lg:col-start-3' : ''}`}>
                    <div class="flex items-center gap-3 mb-2">
                      <span class="text-primary text-5xl font-bold opacity-20">{String(index + 1).padStart(2, '0')}</span>
                      <h3 class="group-hover:text-primary text-3xl font-bold transition-colors">{project.data.title}</h3>
                    </div>
                    <p class="text-muted text-lg leading-relaxed">{project.data.description}</p>
                    {project.data.tags && (
                      <div class="flex flex-wrap gap-2 pt-2">
                        {project.data.tags.map((tag) => (
                          <span class="bg-primary/10 text-primary rounded-full px-4 py-2 text-sm font-medium">
                            {tag}
                          </span>
                        ))}
                      </div>
                    )}
                    <div class="pt-4">
                      <span class="group-hover:text-primary inline-flex items-center gap-2 text-sm font-semibold transition-colors">
                        View Project
                        <svg class="h-4 w-4 transition-transform group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                      </span>
                    </div>
                  </div>
                  <div class={`relative overflow-hidden rounded-xl shadow-lg lg:col-span-2 ${index % 2 === 1 ? 'lg:col-start-1 lg:row-start-1' : ''}`}>
                    <div class="aspect-video">
                      <Image
                        src={project.featuredImage}
                        alt={project.data.title}
                        width={600}
                        height={338}
                        class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
                      />
                    </div>
                  </div>
                </div>
              </a>
            </li>
          ))
        }
      </ul>
    </div>
  </section>
</DefaultLayout>

<style lang="scss">
  a {
    text-decoration: none !important;
    
    &:hover {
      text-decoration: none !important;
    }
  }
  
  li {
    &:hover {
      .aspect-video::after {
        opacity: 0.1;
      }
    }
  }
  
  .aspect-video {
    position: relative;
    
    &::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(to right, transparent, var(--action-color));
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
  }
  
  .no-underline {
    text-decoration: none !important;
  }
</style>
